{% comment %}
  Renders the Feature Cards section as a block within Main Collection
  
  Usage:
  {% render 'collection-feature-cards-block', collection: collection %}
{% endcomment %}

{%- liquid
  assign card_1_image = collection.metafields.custom.feature_card_1_imagen
  assign card_1_title = collection.metafields.custom.feature_card_1_titulo
  assign card_1_link = collection.metafields.custom.feature_card_1_link
  assign card_2_image = collection.metafields.custom.feature_card_2_imagen
  assign card_2_title = collection.metafields.custom.feature_card_2_titulo
  assign card_2_link = collection.metafields.custom.feature_card_2_link
  assign card_3_image = collection.metafields.custom.feature_card_3_imagen
  assign card_3_title = collection.metafields.custom.feature_card_3_titulo
  assign card_3_link = collection.metafields.custom.feature_card_3_link
  assign card_4_image = collection.metafields.custom.feature_card_4_imagen
  assign card_4_title = collection.metafields.custom.feature_card_4_titulo
  assign card_4_link = collection.metafields.custom.feature_card_4_link
  assign card_5_image = collection.metafields.custom.feature_card_5_imagen
  assign card_5_title = collection.metafields.custom.feature_card_5_titulo
  assign card_5_link = collection.metafields.custom.feature_card_5_link
  
  assign has_cards = false
  if card_1_image != blank or card_2_image != blank or card_3_image != blank or card_4_image != blank or card_5_image != blank
    assign has_cards = true
  endif
-%}

<!-- Feature Cards Block DEBUG -->
<!-- collection.handle: {{ collection.handle }} -->
<!-- card_1_image: {{ collection.metafields.custom.card_1_image }} -->
<!-- has_cards: {{ has_cards }} -->
{{ 'component-collection-feature-cards.css' | asset_url | stylesheet_tag }}

{%- if has_cards -%}
  <div class="collection-feature-cards-wrapper">
    <div class="container">
      <div class="feature-cards-grid feature-cards-grid--5 feature-cards-style--standard">
        
        {%- if card_1_image != blank -%}
          <div class="feature-card">
            <a href="{{ card_1_link | default: '#' }}" class="feature-card-link">
              <div class="feature-card-image-wrapper">
                <img src="{{ card_1_image | image_url: width: 400 }}"
                     alt="{{ card_1_title | default: collection.title }}"
                     class="feature-card-image"
                     loading="lazy"
                     width="400"
                     height="400">
              </div>
              {%- if card_1_title != blank -%}
                <div class="feature-card-content">
                  <h3 class="feature-card-title">{{ card_1_title }}</h3>
                </div>
              {%- endif -%}
            </a>
          </div>
        {%- endif -%}
        
        {%- if card_2_image != blank -%}
          <div class="feature-card">
            <a href="{{ card_2_link | default: '#' }}" class="feature-card-link">
              <div class="feature-card-image-wrapper">
                <img src="{{ card_2_image | image_url: width: 400 }}"
                     alt="{{ card_2_title | default: collection.title }}"
                     class="feature-card-image"
                     loading="lazy"
                     width="400"
                     height="400">
              </div>
              {%- if card_2_title != blank -%}
                <div class="feature-card-content">
                  <h3 class="feature-card-title">{{ card_2_title }}</h3>
                </div>
              {%- endif -%}
            </a>
          </div>
        {%- endif -%}
        
        {%- if card_3_image != blank -%}
          <div class="feature-card">
            <a href="{{ card_3_link | default: '#' }}" class="feature-card-link">
              <div class="feature-card-image-wrapper">
                <img src="{{ card_3_image | image_url: width: 400 }}"
                     alt="{{ card_3_title | default: collection.title }}"
                     class="feature-card-image"
                     loading="lazy"
                     width="400"
                     height="400">
              </div>
              {%- if card_3_title != blank -%}
                <div class="feature-card-content">
                  <h3 class="feature-card-title">{{ card_3_title }}</h3>
                </div>
              {%- endif -%}
            </a>
          </div>
        {%- endif -%}
        
        {%- if card_4_image != blank -%}
          <div class="feature-card">
            <a href="{{ card_4_link | default: '#' }}" class="feature-card-link">
              <div class="feature-card-image-wrapper">
                <img src="{{ card_4_image | image_url: width: 400 }}"
                     alt="{{ card_4_title | default: collection.title }}"
                     class="feature-card-image"
                     loading="lazy"
                     width="400"
                     height="400">
              </div>
              {%- if card_4_title != blank -%}
                <div class="feature-card-content">
                  <h3 class="feature-card-title">{{ card_4_title }}</h3>
                </div>
              {%- endif -%}
            </a>
          </div>
        {%- endif -%}
        
        {%- if card_5_image != blank -%}
          <div class="feature-card">
            <a href="{{ card_5_link | default: '#' }}" class="feature-card-link">
              <div class="feature-card-image-wrapper">
                <img src="{{ card_5_image | image_url: width: 400 }}"
                     alt="{{ card_5_title | default: collection.title }}"
                     class="feature-card-image"
                     loading="lazy"
                     width="400"
                     height="400">
              </div>
              {%- if card_5_title != blank -%}
                <div class="feature-card-content">
                  <h3 class="feature-card-title">{{ card_5_title }}</h3>
                </div>
              {%- endif -%}
            </a>
          </div>
        {%- endif -%}
        
      </div>
    </div>
  </div>
  
  <script>
    // Initialize Slick carousel for mobile
    if (window.innerWidth <= 749) {
      const cardsGrid = document.querySelector('.collection-feature-cards-wrapper .feature-cards-grid');
      if (cardsGrid && !cardsGrid.classList.contains('slick-initialized')) {
        // Load Slick if not already loaded
        if (typeof jQuery !== 'undefined' && typeof jQuery.fn.slick !== 'undefined') {
          jQuery(cardsGrid).slick({
            slidesToShow: 2,
            slidesToScroll: 1,
            dots: true,
            arrows: false,
            infinite: false,
            responsive: [
              {
                breakpoint: 749,
                settings: {
                  slidesToShow: 2,
                  slidesToScroll: 1
                }
              }
            ]
          });
        } else {
          // Load Slick library if not present
          const slickCSS = document.createElement('link');
          slickCSS.rel = 'stylesheet';
          slickCSS.href = 'https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css';
          document.head.appendChild(slickCSS);
          
          const slickJS = document.createElement('script');
          slickJS.src = 'https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js';
          slickJS.onload = function() {
            jQuery(cardsGrid).slick({
              slidesToShow: 2,
              slidesToScroll: 1,
              dots: true,
              arrows: false,
              infinite: false,
              responsive: [
                {
                  breakpoint: 749,
                  settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1
                  }
                }
              ]
            });
          };
          document.body.appendChild(slickJS);
        }
      }
    }
  </script>
{%- endif -%}
